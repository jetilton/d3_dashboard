{% extends "base.html" %}

{% block content %}
    <h1>Edit {{ cbt.name }} </h1>
    <form action="" method="post" id = 'paths'>
        {{ form.hidden_tag() }}
	<table>
		<tr>
			<th>{{ form.name.label }}</th>
			<th>{{ form.paths.label }}</th>
		<tr>
			<td>{{ form.name(size=32) }}</td>
			<td>{{ form.paths() }}</td>
		</tr>
	</table>
	{{ form.cbt_id() }}
    <input type = "submit" value = "Add Path"/>
	</form>

	<script type="text/javascript">

	$(document).ready(function() {
        $('form').submit(function (e) {
            var url = "{{ url_for('process_cbt') }}"; // send the form data here.
			var data = $('form').serializeArray().reduce(function(obj, item) {
				obj[item.name] = item.value;
				return obj;
			}, {});
            $.ajax({
                type: "POST",
                url: url,
				headers:{"X-CSRFToken": "{{ form.csrf_token._value() }}"},
                data: $('form').serialize(),// serializes the form's elements.
                success: function (data) {
                    console.log(data)  // display the returned data in the console.
                },
				error: function(){
						console.log(data)
				}
            });
            e.preventDefault(); // block the traditional submission of the form.
        });
			
        // Inject our CSRF token into our AJAX request.
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ form.csrf_token._value() }}")
                }
            }
        })
    });
	</script>
{% endblock %}
